---
import MoonSun from '../assets/moon-sun.svg';
---
<label id="theme-toggle">
  <input type="checkbox" class="sr-only" id="theme-input" />
  <MoonSun id="theme-icon" title="A sun icon with a crescent moon cutout inside."/>
</label>

<script is:inline>
  const theme = (() => {
    const localStorageTheme = localStorage?.getItem('theme') ?? ''

    if (['dark', 'light'].includes(localStorageTheme))
      return localStorageTheme

    if (window.matchMedia('(prefers-color-scheme: dark)').matches)
      return 'dark'

    return 'light'
  })();

  if (theme === 'light')
    document.querySelector('body')?.classList.remove('dark')
  else
    document.querySelector('body')?.classList.add('dark')

  window.localStorage.setItem('theme', theme)

  const handleToggleClick = () => {
    const element = document.querySelector('body')
    element.classList.toggle('dark')

    const isDark = element.classList.contains('dark')
    localStorage.setItem('theme', isDark ? 'dark' : 'light')
  }

  document.getElementById('theme-toggle')?.addEventListener('change', handleToggleClick)
</script>
